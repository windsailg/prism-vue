(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-83744a4a"],{"4e5a":function(t,e,s){"use strict";s("f1ea")},"5f47":function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"container"},[s("hr"),s("Spinner",{class:{"fade-out":!t.isLoading}}),s("div",{staticClass:"row p-0 m-0 mb-5 mt-4 card shadow"},[s("div",{staticClass:"row p-3 mr-3 mt-5 ml-3"},[s("SingleDetail",{attrs:{"initial-product":t.product,commentsLength:t.Comments.length,likesLength:t.likes.length,"is-loading":t.isLoading}})],1),s("div",{staticClass:"col-12 m-0 mb-3 pl-0 pr-0 product__info__block"},[s("div",{staticClass:"row product__nav__block",attrs:{id:"productNav"}},[s("div",{staticClass:"btn product__nav__button",class:{active:"productDetail"===t.tabState},on:{click:function(e){return e.preventDefault(),e.stopPropagation(),t.toggleTabContent("productDetail")}}},[t._v(" 商品詳情 ")]),s("div",{staticClass:"btn product__nav__button",class:{active:"productComments"===t.tabState},on:{click:function(e){return e.preventDefault(),e.stopPropagation(),t.toggleTabContent("productComments")}}},[t._v(" 商品評論 ")])]),""!==t.product.description?s("div",{staticClass:"row col-md-12 mt-5 mr-0 ml-0 mb-5 tab-panel",class:{show:"productDetail"===t.tabState}},[s("div",{staticClass:"col-12"},[t._v(t._s(t.product.description))])]):s("div",{staticClass:"row col-md-12 mt-5 mr-0 ml-0 mb-5 tab-panel",class:{show:"productDetail"===t.tabState}},[s("h3",{staticClass:"col-12 text-center"},[t._v("本商品目前無任何描述")])]),s("div",{staticClass:"row col-md-12 mt-2 mr-0 ml-0 mb-5 tab-panel",class:{show:"productComments"===t.tabState}},[s("div",{staticClass:"row col-md-12 mt-4 mr-0 ml-0 mb-2"},[s("CreateComment",{attrs:{"is-processing":t.isProcessing,currentUser:t.currentUser,productId:t.product.id},on:{createComment:t.createComment}})],1),s("div",{directives:[{name:"show",rawName:"v-show",value:t.Comments.length,expression:"Comments.length"}],staticClass:"row col-md-12 mr-0 ml-0"},[s("SingleComments",{attrs:{"is-processing":t.isProcessing,currentUser:t.currentUser,Comments:t.Comments},on:{deleteComment:t.deleteComment}})],1)]),s("div",{directives:[{name:"show",rawName:"v-show",value:!t.Comments.length,expression:"!Comments.length"}],staticClass:"row col-md-12 mt-5 mr-0 ml-0 mb-5 tab-panel",class:{show:"productComments"===t.tabState}},[s("h3",{staticClass:"col-12 text-center"},[t._v("尚無評論")])])])])],1)},n=[],r=s("1da1"),i=s("5530"),o=(s("4de4"),s("96cf"),function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{directives:[{name:"show",rawName:"v-show",value:!t.isLoading,expression:"!isLoading"}],staticClass:"row p-3 mr-3 ml-3"},[s("div",{staticClass:"col-lg-5 img__box__product"},[s("img",{staticClass:"img-responsive center-block mxw__product",attrs:{src:t.product.image}})]),s("div",{staticClass:"col-md-7"},[s("h3",{staticClass:"product__title__block font-weight-bold"},[t._v(t._s(t.product.name))]),s("span",{staticClass:"badge-pill badge-info"},[t._v(t._s(t.product.Category.name))]),s("div",{staticClass:"mt-3 mb-3 product__description__block"},[t._v(t._s(t.product.description))]),s("h4",{staticClass:"text-warning"},[s("strong",[t._v("NT: "+t._s(t.product.price))])]),s("div",{staticClass:"row m-0"},[s("form",{staticClass:"row m-0 mr-2",attrs:{method:"POST"}},[s("div",{staticClass:"quantity__block mr-2",attrs:{id:"quantityBlock"}},[s("div",{staticClass:"quantity__box quantity__minus",attrs:{id:"quantityMinus"},on:{click:function(e){return e.preventDefault(),e.stopPropagation(),t.ninusQuantity(e)}}},[s("span",{staticClass:"quantity__ele"})]),s("input",{directives:[{name:"model",rawName:"v-model",value:t.quantity,expression:"quantity"}],staticClass:"inputer quantity__box quantity__number",attrs:{id:"itemQuantity",type:"number",value:"1",min:"1",max:"99"},domProps:{value:t.quantity},on:{input:function(e){e.target.composing||(t.quantity=e.target.value)}}}),s("div",{staticClass:"quantity__box quantity__plus",attrs:{id:"quantityPlus"},on:{click:function(e){return e.preventDefault(),e.stopPropagation(),t.plusQuantity(e)}}},[s("span",{staticClass:"quantity__ele"}),s("span",{staticClass:"quantity__ele"})])]),s("input",{attrs:{type:"hidden",name:"productId"},domProps:{value:t.product.id}}),t._m(0)]),t.product.isLiked?s("div",[s("button",{staticClass:"btn mr-2 product__like",attrs:{type:"submit",disabled:t.isProcessing},on:{click:function(e){return e.preventDefault(),e.stopPropagation(),t.removeLike(t.product.id)}}},[s("i",{staticClass:"fas fa-heart text-danger"})])]):s("div",[s("button",{staticClass:"btn mr-2 product__like",attrs:{type:"submit",disabled:t.isProcessing},on:{click:function(e){return e.preventDefault(),e.stopPropagation(),t.addLike(t.product.id)}}},[s("i",{staticClass:"far fa-heart text-danger"})])])])]),s("div",{staticClass:"row col-lg-5 p-0 pl-3 pr-3 mt-4 m-0 flex justify-content-start align-items-center"},[s("div",{staticClass:"col-3 p-0 mr-1"},[s("span",{staticClass:"text-info font-weight-bold mr-1"},[t._v(t._s(t.product.viewCount))]),t._v("次瀏覽 ")]),s("div",{staticClass:"col-3 p-0 mr-1"},[s("span",{staticClass:"text-info font-weight-bold mr-1"},[t._v(t._s(t.likesLength))]),t._v("個喜歡 ")]),s("div",{staticClass:"col-3 p-0 mr-1"},[s("span",{staticClass:"text-info font-weight-bold mr-1"},[t._v(t._s(t.commentsLength))]),t._v("則評論 ")])])])}),c=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("button",{staticClass:"btn btn-info rounded-pill pr-3 pl-3 add__cart font-weight-bold",attrs:{type:"submit"}},[s("i",{staticClass:"fas fa-shopping-bag ml-2 mr-2"}),t._v(" 加入購物籃 ")])}],u=(s("a9e3"),s("4cce")),l=s("2fa3"),m={name:"SingleDetail",props:{initialProduct:{type:Object,required:!0},commentsLength:{type:Number,required:!0},likesLength:{type:Number,required:!0},isLoading:{type:Boolean,default:!0}},data:function(){return{product:this.initialProduct,quantity:1,isProcessing:!1}},methods:{addLike:function(t){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function s(){var a,n;return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:return s.prev=0,e.isProcessing=!0,s.next=4,u["a"].addLike({id:t});case 4:if(a=s.sent,n=a.data,"success"===n.status){s.next=9;break}throw e.toastFire("error",n.message),new Error(n.message);case 9:e.product=Object(i["a"])(Object(i["a"])({},e.product),{},{isLiked:!0}),e.toastFire("success",n.message),e.isProcessing=!1,s.next=19;break;case 14:s.prev=14,s.t0=s["catch"](0),console.log(s.t0),e.isProcessing=!1,e.toastFire("error","操作失敗，請稍後再試");case 19:case"end":return s.stop()}}),s,null,[[0,14]])})))()},removeLike:function(t){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function s(){var a,n;return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:return s.prev=0,e.isProcessing=!0,s.next=4,u["a"].removeLike({id:t});case 4:if(a=s.sent,n=a.data,"success"===n.status){s.next=9;break}throw e.toastFire("error",n.message),new Error(n.message);case 9:e.product=Object(i["a"])(Object(i["a"])({},e.product),{},{isLiked:!1}),e.toastFire("success",n.message),e.isProcessing=!1,s.next=19;break;case 14:s.prev=14,s.t0=s["catch"](0),console.log(s.t0),e.isProcessing=!1,e.toastFire("error","操作失敗，請稍後再試");case 19:case"end":return s.stop()}}),s,null,[[0,14]])})))()},toastFire:function(t,e){l["a"].fire({icon:t,title:e,background:"#eee",showConfirmButton:!1})},plusQuantity:function(){this.quantity>=99||this.quantity++},ninusQuantity:function(){this.quantity<=1||this.quantity--}},watch:{initialProduct:function(t){this.product=Object(i["a"])(Object(i["a"])({},this.product),t)}}},d=m,p=(s("4e5a"),s("2877")),f=Object(p["a"])(d,o,c,!1,null,"4e78647a",null),g=f.exports,b=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"col-12"},t._l(t.Comments,(function(e){return s("div",{key:e.id,staticClass:"mt-4 mb-2"},[s("blockquote",{staticClass:"blockquote mb-0"},[t.currentUser.isAdmin?s("button",{staticClass:"btn btn-sm btn-outline-primary float-right",attrs:{type:"button",disabled:t.isProcessing},on:{click:function(s){return s.preventDefault(),s.stopPropagation(),t.deleteButtonClick(e.id)}}},[s("i",{staticClass:"fas fa-trash-alt"})]):t._e(),s("h5",[s("router-link",{attrs:{to:{name:"profile",params:{id:e.UserId}}}},[t._v(" "+t._s(e.User.name)+" ")])],1),s("div",[t._v(t._s(e.description))]),s("footer",{staticClass:"blockquote-footer"},[t._v(" "+t._s(t._f("fromNow")(e.createdAt)))])])])})),0)},v=[],C=s("2708"),_={name:"SingleComments",props:{Comments:{type:Array,required:!0},currentUser:{type:Object,required:!0},isLoading:{type:Boolean,default:!1},isProcessing:{type:Boolean,default:!1}},data:function(){return{}},methods:{deleteButtonClick:function(t){this.$emit("deleteComment",t)}},mixins:[C["a"]]},h=_,w=Object(p["a"])(h,b,v,!1,null,null,null),k=w.exports,x=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("form",{staticClass:"col-12 mb-3",on:{submit:function(e){return e.preventDefault(),e.stopPropagation(),t.handleSubmit(e)}}},[s("div",{staticClass:"form-group mb-4"},[s("label",{attrs:{for:"text"}},[t._v("留下評論：")]),s("textarea",{directives:[{name:"model",rawName:"v-model",value:t.text,expression:"text"}],staticClass:"form-control",attrs:{rows:"3",name:"text"},domProps:{value:t.text},on:{input:function(e){e.target.composing||(t.text=e.target.value)}}})]),s("div",{staticClass:"d-flex align-items-center justify-content-between"},[s("button",{staticClass:"btn btn-link",attrs:{type:"button"},on:{click:function(e){return t.$router.back()}}},[t._v("回上一頁")]),s("button",{staticClass:"btn btn-primary mr-0",attrs:{type:"submit",disabled:t.isProcessing}},[t._v(" "+t._s(t.isProcessing?"處理中...":"留下評論")+" ")])])])},y=[],P={name:"CreateComments",props:{productId:{type:Number,required:!0},isProcessing:{type:Boolean,default:!1}},data:function(){return{text:""}},methods:{handleSubmit:function(){this.$emit("createComment",{productId:this.productId,description:this.text}),this.text=""}}},q=P,L=Object(p["a"])(q,x,y,!1,null,null,null),D=L.exports,j=s("ee21"),O=s("2375"),S=s("2f62"),F={name:"ProductDetail",computed:Object(i["a"])({},Object(S["b"])(["currentUser"])),components:{SingleDetail:g,SingleComments:k,CreateComment:D,Spinner:O["a"]},data:function(){return{product:{Category:{},CategoryId:-1,description:"",id:-1,image:"",name:"",price:-1,viewCount:-1},likes:[],Comments:[],isProcessing:!1,isLoading:!1,tabState:"productDetail"}},methods:{fetchData:function(t){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function s(){var a,n;return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:return s.prev=0,e.isLoading=!0,s.next=4,j["a"].products.getDetail({id:t});case 4:a=s.sent,n=a.data,e.product=n.product,e.Comments=n.comments,e.likes=n.likes,e.isLoading=!1,s.next=16;break;case 12:s.prev=12,s.t0=s["catch"](0),console.log(s.t0),e.toastFire("error","無法取得商品資訊");case 16:case"end":return s.stop()}}),s,null,[[0,12]])})))()},createComment:function(t){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function s(){var a,n,r,i;return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:return s.prev=0,e.isProcessing=!0,s.next=4,j["a"].comments.create({payload:t});case 4:if(a=s.sent,n=a.data,"success"===n.status){s.next=10;break}return e.toastFire("error",n.message),e.isProcessing=!1,s.abrupt("return");case 10:return r=t.productId,s.next=13,j["a"].products.getDetail({id:r});case 13:i=s.sent,e.Comments=i.data.comments,e.toastFire("success",n.message),e.isProcessing=!1,s.next=24;break;case 19:s.prev=19,s.t0=s["catch"](0),console.log(s.t0),e.toastFire("error","操作失敗，請稍後再試"),e.isProcessing=!1;case 24:case"end":return s.stop()}}),s,null,[[0,19]])})))()},deleteComment:function(t){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function s(){var a,n;return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:return s.prev=0,e.isProcessing=!0,s.next=4,j["a"].comments.delete({id:t});case 4:if(a=s.sent,n=a.data,console.log(n),"success"===n.status){s.next=11;break}return e.toastFire("error",n.message),e.isProcessing=!1,s.abrupt("return");case 11:e.Comments=e.Comments.filter((function(e){return e.id!==t})),e.toastFire("success",n.message),e.isProcessing=!1,s.next=21;break;case 16:s.prev=16,s.t0=s["catch"](0),console.log(s.t0),e.toastFire("error","操作失敗，請稍後再試"),e.isProcessing=!1;case 21:case"end":return s.stop()}}),s,null,[[0,16]])})))()},toggleTabContent:function(t){this.tabState=t},toastFire:function(t,e){l["a"].fire({icon:t,title:e,background:"#eee",showConfirmButton:!1})}},created:function(){var t=this.$route.params.id;this.fetchData(t)},beforeRouteUpdate:function(t,e,s){var a=t.params.id;this.fetchData(a),s()}},N=F,R=(s("be1a"),s("fc3c"),Object(p["a"])(N,a,n,!1,null,"5551dd5e",null));e["default"]=R.exports},be1a:function(t,e,s){"use strict";s("ed8b")},ed8b:function(t,e,s){},f1ea:function(t,e,s){},fc3c:function(t,e,s){"use strict";s("feff")},feff:function(t,e,s){}}]);
//# sourceMappingURL=chunk-83744a4a.505af9cf.js.map